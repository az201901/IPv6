# 15　IPv6 とセキュリティ

# 15.1　IPv6 は IPv4 よりもセキュアというわけではない

# 15.1.1　IPv6 ならではのセキュリティ上の注意点

# 15.2　近隣探索プロトコルとセキュリティ

# 15.2.3　ルータに関連する攻撃

　RFC 3756 では、 DoS 攻撃に
よって正規のデフォルトルータを「殺す」攻撃の可能性が説明されています。その状況で、悪
意あるノードがデフォルトルータであることを表明すれば、事実上の Man-in-the-Middle 攻撃
などが可能になります。

　Redirect メッセージを利用した攻撃も考えられます。最初の次ホップとなるルータのリンク
ローカルアドレスを送信元とする Redirect メッセージを偽造することで、そのルータを最初の
次ホップとして利用しているホストのトラフィックを不正にリダイレクトすることが可能にな
るでしょう。

# 15.2.4　リプレイ攻撃

　ここでリプレイ攻撃と呼んでいるのは、ノードが受け取った近隣探索メッセージを攻撃者が
横取りし、それを都合がいいタイミングで再送するという攻撃です。メッセージの内容を改ざ
んするわけではないので、通信の暗号化などでは防げません。

　要求に対して応答する場合 （ Router Solicitation メッセージに対する Router Advertisement
メッセージのような）であれば、応答に Nonce を含めなければならないようにすることで、有
効な Nonce が含まれない古いメッセージを利用したリプレイ攻撃を防げます。

　単発で送信される Advertisement メッセージや Redirect メッセージをリプレイ攻撃から守
る方法としては、タイムスタンプなどがあります。ネットワークに接続されたノード同士の時
刻同期の精度が高くなかったとしても、タイムスタンプによって示される時間の差を確認する
ことで、新たに受け取ったメッセージが以前のものよりも新しいことを確認できるでしょう。

# 15.2.5　遠隔からの攻撃

　RFC 3756 では、攻撃者が特定のサブネットプレフィックスに対するアドレスを加工し続け
るという、近隣探索プロトコルに対する遠隔からの攻撃が説明されています。それらのパケッ
トを受け取ったルータは、サブネット内で該当するアドレスに対応するリンク層アドレスを解
決するため、 Neighbor Solicitation メッセージをサブネットに対して送信します。実在するサ
ブネットプレフィックスの実在しないインターフェース識別子を問い合わせ続けることになる
ので、近隣キャッシュがあふれ、事実上の DoS 攻撃になります。

　遠隔からの攻撃は、ルータに対してだけではなく、ホストに対しても可能です。アプリケー
ションを騙し、 on-link の宛先に向かってパケットを送り続けさせることで、ホストにおける
近隣探索プロトコルの処理を誘発させるというものです。

# 15.2.6　近隣探索プロトコルとフラグメンテーション

　不正な近隣探索メッセージによる影響を軽減するための手段として、 15.4.2 項で説明する
RA ガードや IPS （ Intrusion Prevention System ）などが知られています。しかし、 IPv6 フラ
グメンテーションを悪用することで、そういった軽減策をすり抜けることが可能になる場合が
あります。この問題は RFC 6980 † 3 で指摘されています。 RFC 6980 は Standards Track であ
り、近隣探索プロトコルについて定義した RFC 4861 と、次節で後述する SEND について定義
した RFC 3971 とを更新する内容という位置づけです。

　RFC 6980 では、すべての近隣探索プロトコルメッセージ（次節で扱う SEND の Certification
Path Solicitation メッセージを含む）について、 IPv6 フラグメントヘッダが含まれるものは無
効であるとしています。そのようなパケットを受け取ったノードは、そのパケットを破棄する
ことが求められています。

# 15.3　SEND （ SEcure Neighbor Discovery ）

　近隣探索プロトコルのもともとの仕様では、近隣探索プロトコルのメッセージは IPsec に
よって守られる場合があるとされていました。しかし、 IPsec の利用にあたっては、鍵交換を
自動的に行う手法が必要という制約があります。実際、当初の近隣探索プロトコルにおける
メッセージの送受信に対する暗号化は、手動での鍵管理が可能な状況に限定されていました。

　IPsec を利用することなく近隣探索プロトコルに対してセキュリティを提供する仕組みとし
て考案されたのが、SEND（ SEcure Neighbor Discovery ）です。 SEND は RFC 3971 † 4 で標準
化されています。 RFC 3971 が発行されたのは 2005 年のことですが、運用のオーバーヘッド
が高く、実装も不十分な状況であることから、 SEND の利用は現在でも一般的であるとは言い
難い状況です（背景については RFC 6980 を参照してください） 。

# 15.3.1　SEND のための新しいオプション

　SEND では、近隣探索プロトコルのさまざまな機能を安全にするために、 7.5 節で紹介した近
隣探索メッセージのオプションを新しく 4 つ利用します。

```
・CGA オプション
・RSA Signature オプション
・Timestamp オプション
・Nonce オプション
```


